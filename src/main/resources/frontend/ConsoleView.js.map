{"version":3,"file":"ConsoleView.js","sources":["../../../../frontend/src/utils/i18n.ts","../../../../frontend/src/views/ConsoleView.vue"],"sourcesContent":["import { I18N } from \"luna\";\nconst loadI18N = async (locale: string) => {\n  try {\n    const {messages} = await import(`./locales/messages_${locale}.ts`);\n    return messages;\n  } catch (e) {\n    return {};\n  }\n}\n\nexport const $i18n = new I18N(['ru'], loadI18N);","<script setup lang=\"ts\">\nimport CodeEditor from \"@/components/CodeEditor.vue\";\nimport { inject, ref } from \"vue\";\nimport { ButtonBusy, NotifyComponentInterface, Errors } from \"luna\";\nimport { scriptService } from \"@/services/scriptService.ts\";\nimport { $i18n } from \"@/utils/i18n.ts\";\n\nconst value = ref<string>(\"System.out.println(\\\"Hello\\\");\\nlog.info(\\\"hello world\\\")\");\nconst busy = ref(false);\nconst out = ref<Array<string>>([]);\nconst activeTab = ref<'log'|'result'>('result');\nconst result = ref<string>(null);\nconst $notify = inject<NotifyComponentInterface>('$notify');\nconst LIMIT = 300;\nconst errors = ref<Errors>({});\n\nconst onResultFetch = (resp: {log?: string, result?: string, error?: any}) => {\n  //console.log(resp);\n  if (resp.log) {\n    out.value.push(resp.log);\n  }\n\n  if (out.value.length > LIMIT) {\n    out.value.shift();\n  }\n\n  if (resp.result != undefined) {\n    result.value = resp.result;\n    busy.value = false;\n    activeTab.value = 'result';\n  }\n\n  if (resp.error) {\n    busy.value = false;\n    $notify.error($i18n.t(\"Failed to execute script\"));\n    if (typeof resp.error == 'string') {\n      try {\n        const data = JSON.parse(resp.error);\n        if (data.errors) {\n          errors.value = data.errors;\n        }\n      } catch (e) {}\n    }\n  }\n}\n\nconst runScript = () => {\n  if (!value.value) {\n    return;\n  }\n  result.value = null;\n  out.value = [];\n  activeTab.value = 'log';\n  busy.value = true;\n  scriptService.runScript(value.value, onResultFetch);\n}\n\n</script>\n\n<template>\n  <div class=\"gravity-page gravity-page-console pad\">\n    <nav class=\"breadcrumbs header\">\n      <ol role=\"list\">\n        <li>Gravity</li>\n        <li>Console</li>\n      </ol>\n    </nav>\n    <div class=\"pad panel editor-panel\">\n      <CodeEditor v-model=\"value\" :diabled=\"busy\"></CodeEditor>\n      <ButtonBusy :busy=\"busy\" :disabled=\"busy\" @click=\"runScript\">{{ $i18n.t(\"Execute\") }}</ButtonBusy>\n    </div>\n\n\n    <div class=\"tabs-header no-border\">\n      <ul>\n        <li :class=\"{active: activeTab == 'result'}\">\n          <button type=\"button\" @click=\"activeTab='result'\">Result</button>\n        </li>\n        <li :class=\"{active: activeTab == 'log'}\">\n          <button type=\"button\" @click=\"activeTab='log'\">Log</button>\n        </li>\n      </ul>\n    </div>\n\n    <div v-if=\"activeTab=='log'\" class=\"panel pad log-tab\">\n      <div v-for=\"(line, idx) in out\" :key=\"idx\">{{ line }}</div>\n      <div class=\"error\" v-if=\"errors.message\">\n        {{ errors.message }}\n      </div>\n    </div>\n\n    <div v-if=\"activeTab=='result'\" class=\"panel pad result-tab\">\n      {{ result }}\n    </div>\n\n  </div>\n</template>\n\n<style scoped>\n  .gravity-page-console {\n    .editor-panel {\n      display: flex;\n      flex-direction: column;\n      gap: 20px;\n    }\n\n    .log-tab {\n      .error {\n        color: red;\n      }\n    }\n  }\n</style>\n"],"names":["CodeEditor"],"mappings":"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"}